(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{2105:function(t,e,a){Promise.resolve().then(a.t.bind(a,2579,23)),Promise.resolve().then(a.t.bind(a,2778,23)),Promise.resolve().then(a.bind(a,3249))},3249:function(t,e,a){"use strict";a.d(e,{AuthProvider:function(){return h},a:function(){return d}});var r=a(7437),o=a(2265);let n="https://faithlink360-api.onrender.com";class s{async fetchWithAuth(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=localStorage.getItem("auth_token"),r={"Content-Type":"application/json",...a&&{Authorization:"Bearer ".concat(a)},...e.headers},o=await fetch("".concat(n).concat(t),{...e,headers:r});if(!o.ok)throw Error((await o.json().catch(()=>({message:o.statusText}))).message||"HTTP ".concat(o.status,": ").concat(o.statusText));return o.json()}async login(t){let e=await fetch("".concat(n,"/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw Error((await e.json().catch(()=>({message:e.statusText}))).message||"Login failed: ".concat(e.statusText));let a=await e.json();return a.token&&(localStorage.setItem("auth_token",a.token),localStorage.setItem("user",JSON.stringify(a.user))),a}async register(t){return this.fetchWithAuth("/api/auth/register",{method:"POST",body:JSON.stringify(t)})}async getCurrentUser(){return this.fetchWithAuth("/api/auth/me")}async refreshToken(){return this.fetchWithAuth("/api/auth/refresh",{method:"POST"})}async logout(){localStorage.removeItem("auth_token"),localStorage.removeItem("user");try{await this.fetchWithAuth("/api/auth/logout",{method:"POST"})}catch(t){console.log("Backend logout failed, but local logout successful")}}async forgotPassword(t){return this.fetchWithAuth("/api/auth/forgot-password",{method:"POST",body:JSON.stringify({email:t})})}async resetPassword(t,e){return this.fetchWithAuth("/api/auth/reset-password",{method:"POST",body:JSON.stringify({token:t,password:e})})}isTokenValid(){let t=localStorage.getItem("auth_token");if(!t)return!1;try{let e=JSON.parse(atob(t.split(".")[1]));return 1e3*e.exp>Date.now()}catch(t){return!1}}}let i=new s,u=(0,o.createContext)(void 0),l=(t,e)=>{switch(e.type){case"LOGIN_START":return{...t,isLoading:!0,error:null};case"LOGIN_SUCCESS":return{...t,user:e.payload,isAuthenticated:!0,isLoading:!1,error:null};case"LOGIN_ERROR":return{...t,user:null,isAuthenticated:!1,isLoading:!1,error:e.payload};case"LOGOUT":return{...t,user:null,isAuthenticated:!1,isLoading:!1,error:null};case"CLEAR_ERROR":return{...t,error:null};case"SET_LOADING":return{...t,isLoading:e.payload};default:return t}},c={user:null,isAuthenticated:!1,isLoading:!0,error:null};function h(t){let{children:e}=t,[a,n]=(0,o.useReducer)(l,c);(0,o.useEffect)(()=>{(async()=>{try{if(localStorage.getItem("auth_token")){let t=await i.getCurrentUser();n({type:"LOGIN_SUCCESS",payload:t})}}catch(t){localStorage.removeItem("auth_token")}finally{n({type:"SET_LOADING",payload:!1})}})()},[]);let s=async t=>{n({type:"LOGIN_START"});try{let e=await i.login(t);localStorage.setItem("auth_token",e.token),n({type:"LOGIN_SUCCESS",payload:e.user})}catch(t){n({type:"LOGIN_ERROR",payload:t instanceof Error?t.message:"Login failed"})}},h=async t=>{n({type:"LOGIN_START"});try{let e=await i.register(t);localStorage.setItem("auth_token",e.token),n({type:"LOGIN_SUCCESS",payload:e.user})}catch(t){n({type:"LOGIN_ERROR",payload:t instanceof Error?t.message:"Registration failed"})}},d={...a,login:s,register:h,logout:()=>{localStorage.removeItem("authToken"),n({type:"LOGOUT"})},clearError:()=>{n({type:"CLEAR_ERROR"})}};return(0,r.jsx)(u.Provider,{value:d,children:e})}function d(){let t=(0,o.useContext)(u);if(void 0===t)throw Error("useAuth must be used within an AuthProvider");return t}},2778:function(){},2579:function(t){t.exports={style:{fontFamily:"'__Inter_f367f3', '__Inter_Fallback_f367f3'",fontStyle:"normal"},className:"__className_f367f3"}}},function(t){t.O(0,[2002,2971,2117,1744],function(){return t(t.s=2105)}),_N_E=t.O()}]);
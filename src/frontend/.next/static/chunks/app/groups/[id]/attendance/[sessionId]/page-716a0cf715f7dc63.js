(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2744],{8438:function(e,t,s){Promise.resolve().then(s.bind(s,9966))},9966:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return S}});var a=s(7437),n=s(2265),r=s(9376),i=s(3002),c=s(8742),o=s(7648),l=s(3249),d=s(3306),u=s(3430),h=s(5302),m=s(5131),p=s(4789),x=s(9663),g=s(5805),f=s(2660),b=s(1723),y=s(8736),j=s(2735),w=s(8930),v=s(4630);function N(e){let{groupId:t,sessionId:s}=e,{user:i}=(0,l.a)(),c=(0,r.useRouter)(),[N,S]=(0,n.useState)(null),[A,T]=(0,n.useState)(""),[E,C]=(0,n.useState)(!0),[G,k]=(0,n.useState)(null),[_,O]=(0,n.useState)(null),[R,P]=(0,n.useState)(!1);(0,n.useEffect)(()=>{q()},[s]);let q=async()=>{try{C(!0),k(null);let[e,a]=await Promise.all([d.n.getAttendanceSession(s),u.P.getGroup(t)]);S(e),T(a.name)}catch(e){k(e instanceof Error?e.message:"Failed to load session data")}finally{C(!1)}},I=async(e,t)=>{if(N)try{P(!0),k(null);let a=N.records.find(t=>t.id===e);if(!a)return;let n=[{memberId:a.memberId,status:t,notes:a.notes}];await d.n.bulkUpdateAttendance(s,n),await q()}catch(e){k(e instanceof Error?e.message:"Failed to update attendance")}finally{P(!1),O(null)}},U=async()=>{if(N&&confirm("Are you sure you want to delete this attendance session? This action cannot be undone."))try{await d.n.deleteAttendanceSession(s),c.push("/groups/".concat(t,"/attendance"))}catch(e){k(e instanceof Error?e.message:"Failed to delete session")}},D=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"csv";if(N)try{let a=await d.n.exportAttendance({groupId:t,startDate:N.date,endDate:N.date},e),n=URL.createObjectURL(a),r=document.createElement("a");r.href=n,r.download="attendance-".concat(N.date,"-").concat(s,".").concat(e),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}catch(e){k(e instanceof Error?e.message:"Failed to export session data")}},M=e=>e?new Date("2000-01-01T".concat(e)).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",W=e=>{switch(e){case"present":return"bg-green-100 text-green-800";case"absent":return"bg-red-100 text-red-800";case"late":return"bg-yellow-100 text-yellow-800";case"excused":return"bg-blue-100 text-blue-800";default:return"bg-neutral-100 text-neutral-800"}},Z=e=>{switch(e){case"present":return(0,a.jsx)(h.Z,{className:"w-4 h-4"});case"absent":return(0,a.jsx)(m.Z,{className:"w-4 h-4"});case"late":return(0,a.jsx)(p.Z,{className:"w-4 h-4"});case"excused":return(0,a.jsx)(x.Z,{className:"w-4 h-4"});default:return(0,a.jsx)(g.Z,{className:"w-4 h-4"})}},L=()=>N&&0!==N.totalMembers?Math.round(N.presentCount/N.totalMembers*100):0,J=(null==i?void 0:i.role)==="admin"||(null==i?void 0:i.role)==="pastor"||N&&N.recordedBy===(null==i?void 0:i.id);return E?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):G||!N?(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsx)("div",{className:"text-sm text-red-700",children:G||"Session not found"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[G&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsx)("div",{className:"text-sm text-red-700",children:G})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200 p-6",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"flex items-center space-x-3 mb-2",children:(0,a.jsxs)(o.default,{href:"/groups/".concat(t,"/attendance"),className:"inline-flex items-center text-sm text-neutral-600 hover:text-neutral-900",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4 mr-1"}),"Back to Attendance History"]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-neutral-900",children:new Date(N.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),N.topic&&(0,a.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800",children:N.topic}),(0,a.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(L()>=80?"bg-green-100 text-green-800":L()>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:[L(),"% attendance"]})]}),(0,a.jsx)("p",{className:"text-neutral-600 mb-4",children:A}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[N.startTime&&(0,a.jsxs)("div",{className:"flex items-center text-neutral-600",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4 mr-2"}),M(N.startTime),N.endTime&&" - ".concat(M(N.endTime))]}),(0,a.jsxs)("div",{className:"flex items-center text-neutral-600",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4 mr-2"}),N.presentCount,"/",N.totalMembers," members present"]}),(0,a.jsxs)("div",{className:"flex items-center text-neutral-600",children:[(0,a.jsx)(x.Z,{className:"w-4 h-4 mr-2"}),"Recorded by ",N.recordedByName]})]}),N.notes&&(0,a.jsx)("div",{className:"mt-4 p-3 bg-neutral-50 rounded-md",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 mr-2 mt-0.5 text-neutral-500"}),(0,a.jsx)("p",{className:"text-sm text-neutral-700",children:N.notes})]})})]}),J&&(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("button",{onClick:()=>D("csv"),className:"inline-flex items-center px-3 py-2 border border-neutral-300 rounded-md text-sm font-medium text-neutral-700 bg-white hover:bg-neutral-50",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4 mr-2"}),"Export"]}),(0,a.jsxs)("button",{onClick:U,className:"inline-flex items-center px-3 py-2 border border-red-300 rounded-md text-sm font-medium text-red-700 bg-white hover:bg-red-50",children:[(0,a.jsx)(w.Z,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200 p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-neutral-600",children:"Present"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:N.presentCount})]}),(0,a.jsx)(h.Z,{className:"w-8 h-8 text-green-600"})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200 p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-neutral-600",children:"Absent"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-red-600",children:N.absentCount})]}),(0,a.jsx)(m.Z,{className:"w-8 h-8 text-red-600"})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200 p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-neutral-600",children:"Late"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:N.lateCount})]}),(0,a.jsx)(p.Z,{className:"w-8 h-8 text-yellow-600"})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200 p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-neutral-600",children:"Excused"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:N.excusedCount})]}),(0,a.jsx)(x.Z,{className:"w-8 h-8 text-blue-600"})]})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200",children:[(0,a.jsx)("div",{className:"p-6 border-b border-neutral-200",children:(0,a.jsxs)("h3",{className:"text-lg font-medium text-neutral-900",children:["Member Attendance (",N.records.length," members)"]})}),(0,a.jsx)("div",{className:"divide-y divide-neutral-200",children:N.records.map(e=>(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(g.Z,{className:"w-5 h-5 text-primary-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-neutral-900",children:e.memberName}),(0,a.jsxs)("p",{className:"text-xs text-neutral-500",children:["Member ID: ",e.memberId]})]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-4",children:J&&_===e.id?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[["present","absent","late","excused"].map(t=>(0,a.jsxs)("button",{onClick:()=>I(e.id,t),disabled:R,className:"flex items-center space-x-1 px-3 py-1 rounded-md text-xs font-medium border ".concat(e.status===t?W(t):"bg-white text-neutral-600 border-neutral-300 hover:bg-neutral-50"," disabled:opacity-50"),children:[Z(t),(0,a.jsx)("span",{className:"capitalize",children:t})]},t)),(0,a.jsx)("button",{onClick:()=>O(null),className:"px-2 py-1 text-xs text-neutral-600 hover:text-neutral-900",children:"Cancel"})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("span",{className:"inline-flex items-center space-x-1 px-3 py-1 rounded-md text-sm font-medium ".concat(W(e.status)),children:[Z(e.status),(0,a.jsx)("span",{className:"capitalize",children:e.status})]}),J&&(0,a.jsx)("button",{onClick:()=>O(e.id),className:"text-neutral-400 hover:text-neutral-600",children:(0,a.jsx)(v.Z,{className:"w-4 h-4"})})]})})]}),e.notes&&(0,a.jsx)("div",{className:"mt-3 ml-14",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 mr-2 mt-0.5 text-neutral-400"}),(0,a.jsx)("p",{className:"text-sm text-neutral-600",children:e.notes})]})})]},e.id))})]})]})}function S(){let e=(0,r.useParams)(),t=e.id,s=e.sessionId;return(0,a.jsx)(i.Z,{requiredRole:"group_leader",children:(0,a.jsx)(c.Z,{children:(0,a.jsx)(N,{groupId:t,sessionId:s})})})}},3306:function(e,t,s){"use strict";s.d(t,{n:function(){return c}});let a="https://faithlink360-api.onrender.com",n=new Map,r=new Map;class i{async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3e4;if(s&&"GET"===t.method){let e=n.get(s);if(e&&Date.now()-e.timestamp<e.ttl)return e.data}let c="".concat(t.method||"GET","_").concat(e,"_").concat(JSON.stringify(t.body));if(r.has(c))return r.get(c);let o="".concat(a).concat(e),l=localStorage.getItem("auth_token"),d={...t,headers:{"Content-Type":"application/json",...l&&{Authorization:"Bearer ".concat(l)},...t.headers}},u=this.makeRequest(o,d,s,i);return r.set(c,u),u.finally(()=>{r.delete(c)}),u}async makeRequest(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3e4,r=Error("Unknown error occurred");for(let i=1;i<=3;i++)try{let r=await fetch(e,t);if(!r.ok){if(429===r.status){await new Promise(e=>setTimeout(e,1e3*i));continue}throw Error("HTTP ".concat(r.status,": ").concat(r.statusText))}let c=await r.json();return s&&"GET"===t.method&&n.set(s,{data:c,timestamp:Date.now(),ttl:a}),c}catch(e){if(r=e instanceof Error?e:Error("Unknown error"),3===i)break;await new Promise(e=>setTimeout(e,1e3*i))}throw r}async getAttendanceSessions(e){let t=new URLSearchParams;Object.entries(e).forEach(e=>{let[s,a]=e;null!=a&&""!==a&&t.append(s,String(a))});let s="attendance_sessions_".concat(t.toString());return this.request("/api/attendance?".concat(t.toString()),{method:"GET"},s)}async getAttendanceSession(e){return this.request("/api/attendance/".concat(e),{method:"GET"},"attendance_session_".concat(e))}async createAttendanceSession(e){let t=await this.request("/api/attendance",{method:"POST",body:JSON.stringify(e)});return this.invalidateGroupCache(e.groupId),t}async updateAttendanceSession(e){let t=await this.request("/api/attendance/".concat(e.id),{method:"PUT",body:JSON.stringify(e)});return n.delete("attendance_session_".concat(e.id)),t}async deleteAttendanceSession(e){await this.request("/api/attendance/".concat(e),{method:"DELETE"}),n.delete("attendance_session_".concat(e)),this.invalidateAllGroupCaches()}async getAttendanceStats(e,t,s){let a=new URLSearchParams({groupId:e});t&&a.append("startDate",t),s&&a.append("endDate",s);let n="attendance_stats_".concat(a.toString());return this.request("/api/attendance/stats?".concat(a.toString()),{method:"GET"},n,6e4)}async exportAttendance(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"csv",s=new URLSearchParams;Object.entries(e).forEach(e=>{let[t,a]=e;null!=a&&""!==a&&s.append(t,String(a))}),s.append("format",t);let n=await fetch("".concat(a,"/api/attendance/export?").concat(s.toString()),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}});if(!n.ok)throw Error("Export failed: ".concat(n.statusText));return n.blob()}async bulkUpdateAttendance(e,t){let s=await this.request("/api/attendance/".concat(e,"/bulk-update"),{method:"POST",body:JSON.stringify({updates:t})});return n.delete("attendance_session_".concat(e)),s}invalidateGroupCache(e){for(let[t]of n)(t.includes("groupId=".concat(e))||t.includes("group_".concat(e)))&&n.delete(t)}invalidateAllGroupCaches(){for(let[e]of n)e.includes("attendance_")&&n.delete(e)}clearCache(){n.clear(),r.clear()}}let c=new i},3430:function(e,t,s){"use strict";s.d(t,{P:function(){return r}});let a="https://faithlink360-api.onrender.com";class n{async fetchWithAuth(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=localStorage.getItem("auth_token"),n={"Content-Type":"application/json",...s&&{Authorization:"Bearer ".concat(s)},...t.headers},r=0;for(;r<=this.MAX_RETRIES;)try{let s=await fetch("".concat(a).concat(e),{...t,headers:n});if(!s.ok){if(429===s.status&&r<this.MAX_RETRIES){await new Promise(e=>setTimeout(e,1e3*(r+1))),r++;continue}let e=await s.json().catch(()=>({message:s.statusText}));throw Error(e.message||"HTTP ".concat(s.status,": ").concat(s.statusText))}return s.json()}catch(e){if(r<this.MAX_RETRIES&&e.message.includes("fetch")){r++,await new Promise(e=>setTimeout(e,1e3*r));continue}throw e}}getCacheKey(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"".concat(e,"-").concat(JSON.stringify(t.body||{}))}isValidCache(e){let t=this.requestCache.get(e);return!!t&&Date.now()-t.timestamp<this.CACHE_DURATION}async getGroups(e){let t=new URLSearchParams;if(e){var s,a,n;e.query&&t.append("query",e.query),(null===(s=e.type)||void 0===s?void 0:s.length)&&t.append("type",e.type.join(",")),(null===(a=e.status)||void 0===a?void 0:a.length)&&t.append("status",e.status.join(",")),e.leaderId&&t.append("leaderId",e.leaderId),(null===(n=e.tags)||void 0===n?void 0:n.length)&&t.append("tags",e.tags.join(",")),void 0!==e.hasAvailableSpace&&t.append("hasAvailableSpace",e.hasAvailableSpace.toString()),e.sortBy&&t.append("sortBy",e.sortBy),e.sortOrder&&t.append("sortOrder",e.sortOrder),e.limit&&t.append("limit",e.limit.toString()),e.offset&&t.append("offset",e.offset.toString())}let r="/api/groups".concat(t.toString()?"?".concat(t.toString()):""),i=this.getCacheKey(r);if(this.isValidCache(i))return this.requestCache.get(i).data;if(this.pendingRequests.has(i))return this.pendingRequests.get(i);let c=this.fetchWithAuth(r).then(e=>(this.requestCache.set(i,{data:e,timestamp:Date.now()}),this.pendingRequests.delete(i),e)).catch(e=>{throw this.pendingRequests.delete(i),e});return this.pendingRequests.set(i,c),c}async getGroup(e){return this.fetchWithAuth("/api/groups/".concat(e))}async createGroup(e){return this.fetchWithAuth("/api/groups",{method:"POST",body:JSON.stringify(e)})}async updateGroup(e){return this.fetchWithAuth("/api/groups/".concat(e.id),{method:"PUT",body:JSON.stringify(e)})}async deleteGroup(e){await this.fetchWithAuth("/api/groups/".concat(e),{method:"DELETE"})}async getGroupMembers(e){return(await this.fetchWithAuth("/api/groups/".concat(e,"/members"))).members||[]}async addGroupMember(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"member";return this.fetchWithAuth("/api/groups/".concat(e,"/members"),{method:"POST",body:JSON.stringify({memberId:t,role:s})})}async updateGroupMember(e,t,s){return this.fetchWithAuth("/api/groups/".concat(e,"/members/").concat(t),{method:"PUT",body:JSON.stringify(s)})}async removeGroupMember(e,t){await this.fetchWithAuth("/api/groups/".concat(e,"/members/").concat(t),{method:"DELETE"})}async getGroupAttendance(e,t,s){let a=new URLSearchParams;t&&a.append("startDate",t),s&&a.append("endDate",s);let n="/api/groups/".concat(e,"/attendance").concat(a.toString()?"?".concat(a.toString()):"");return this.fetchWithAuth(n)}async recordAttendance(e){return this.fetchWithAuth("/api/groups/".concat(e.groupId,"/attendance"),{method:"POST",body:JSON.stringify(e)})}async updateAttendance(e,t,s){return this.fetchWithAuth("/api/groups/".concat(e,"/attendance/").concat(t),{method:"PUT",body:JSON.stringify(s)})}async deleteAttendance(e,t){await this.fetchWithAuth("/api/groups/".concat(e,"/attendance/").concat(t),{method:"DELETE"})}async getGroupStats(){return this.fetchWithAuth("/api/groups/stats")}async getGroupAttendanceStats(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"month";return this.fetchWithAuth("/api/groups/".concat(e,"/stats/attendance?period=").concat(t))}async exportGroups(e){let t=new URLSearchParams;if(e){var s,n;e.query&&t.append("query",e.query),(null===(s=e.type)||void 0===s?void 0:s.length)&&t.append("type",e.type.join(",")),(null===(n=e.status)||void 0===n?void 0:n.length)&&t.append("status",e.status.join(","))}let r=localStorage.getItem("auth_token"),i=await fetch("".concat(a,"/api/groups/export").concat(t.toString()?"?".concat(t.toString()):""),{headers:{...r&&{Authorization:"Bearer ".concat(r)}}});if(!i.ok)throw Error("Export failed: ".concat(i.statusText));return i.blob()}async bulkUpdateGroups(e,t){return this.fetchWithAuth("/api/groups/bulk",{method:"PUT",body:JSON.stringify({groupIds:e,updates:t})})}async bulkDeleteGroups(e){return this.fetchWithAuth("/api/groups/bulk",{method:"DELETE",body:JSON.stringify({groupIds:e})})}async getGroupTypes(){return[{value:"small_group",label:"Small Group",description:"Intimate fellowship and Bible study groups"},{value:"ministry",label:"Ministry Team",description:"Service-focused ministry groups"},{value:"youth",label:"Youth Group",description:"Teen and young adult groups"},{value:"seniors",label:"Seniors Group",description:"Groups for older adults"},{value:"womens",label:"Women's Group",description:"Women's fellowship and study groups"},{value:"mens",label:"Men's Group",description:"Men's fellowship and study groups"},{value:"children",label:"Children's Group",description:"Groups for children and families"},{value:"worship",label:"Worship Team",description:"Music and worship ministry teams"},{value:"service",label:"Service Team",description:"Community service and outreach teams"},{value:"bible_study",label:"Bible Study",description:"Scripture study and discussion groups"},{value:"prayer",label:"Prayer Group",description:"Prayer and intercession groups"},{value:"outreach",label:"Outreach Team",description:"Evangelism and community outreach"},{value:"other",label:"Other",description:"Custom group types"}]}constructor(){this.requestCache=new Map,this.pendingRequests=new Map,this.CACHE_DURATION=3e4,this.MAX_RETRIES=2}}let r=new n}},function(e){e.O(0,[7648,6394,4429,2971,2117,1744],function(){return e(e.s=8438)}),_N_E=e.O()}]);